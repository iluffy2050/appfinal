<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Global Chat</title>
<style>
body { font-family: Arial, sans-serif; }
#chat { border: 1px solid #ccc; height: 400px; overflow-y: scroll; padding: 10px; }
.message { margin: 5px 0; }
.pfp { width: 30px; height: 30px; border-radius: 50%; vertical-align: middle; margin-right: 5px; }
</style>
</head>
<body>

<h2>Global Chat</h2>
<div>
    Username: <input type="text" id="username" placeholder="Your name">
    PFP URL: <input type="text" id="pfp" placeholder="Profile picture URL">
</div>

<div id="chat"></div>

<input type="text" id="message" placeholder="Type a message...">
<button onclick="sendMessage()">Send</button>

<script>
let username = '';
let pfp = '';

function joinChat() {
    username = document.getElementById('username').value;
    pfp = document.getElementById('pfp').value;
    if (!username) alert("Enter a username");
}
document.getElementById('username').addEventListener('change', joinChat);

// Send message to server
function sendMessage() {
    const msg = document.getElementById('message').value;
    if (!username || !msg) return;
    fetch('/send', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({username, pfp, message: msg})
    });
    document.getElementById('message').value = '';
}

// Fetch messages every second
async function fetchMessages() {
    const res = await fetch('/get_messages');
    const data = await res.json();
    const chat = document.getElementById('chat');
    chat.innerHTML = '';
    data.forEach(msg => {
        const div = document.createElement('div');
        div.className = 'message';
        div.innerHTML = `<img src="${msg.pfp}" class="pfp">${msg.username}: ${msg.message}`;
        chat.appendChild(div);
    });
    chat.scrollTop = chat.scrollHeight;
}

setInterval(fetchMessages, 1000);  // Poll every 1 second
</script>

</body>
</html>
